
## 为什么 进程切换 会 比 线程切换 消耗的资源要多  


切换 指的是 上下文切换，  进程切换 和 线程切换 都是 CPU 上下文切换 的一种。  

CPU 上下文切换(Context Switch) 指的是  把当前任务的  
寄存器（存储私有变量） + 程序计数器（程序执行到哪里）  保存起来，   

加载  新的任务  的上下文  到 寄存器 + 计数器  







* 进程切换的 流程  

保存   
用户态的上下文（进程 虚拟内存地址，私有变量，程序执行栈） +  内核态的上下文（因为一个进程 有可能 会进行系统调用，比如 读写文件，所以也会有 内核态的上下文）  

将 新的进程的  
用户态上下文 + 内核态上下文，  加载进 寄存器 + 程序计数器，  

将 切换的进程 的 虚拟地址   
刷进 TLB （保存 物理地址 和 虚拟地址 的 映射关系 的页表）   





* 线程切换的 流程（特指 同个进程下 的线程 上下文切换）

因为 线程切换  都是 基于 同个进程的， 
比起 进程切换，不需要保存 线程 虚拟地址。其他 流程基本相同







* 两者 切换区别  

从上面 两个流程的比较，最大的区别  是 进程切换  需要刷新 TLB，   

而切换时 刷新 TLB 就意味着 
要重新 建立 物理内存地址 和 虚拟内存地址 的映射关系，这个过程是 很耗时 且 耗费 CPU 资源的。  
