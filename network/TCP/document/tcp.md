
## TCP 报文格式
　　
IP 数据报 ＝ 20 字节 IP 首部 ＋ TCP 报文段  

TCP 报文段 ＝ 20 字节 TCP 首部 ＋ TCP 数据   
TCP 首部的固定数据有 20 字节，加上选项部分 最大可达 60 字节，  
而 有效数据部分 则是 被打包的 应用层数据。  

主要字段：  

1. 序号： 这个字段的主要作用 是 用于将失序的数据 重新排列。

2. 确认序号：接收方 在接受到数据后，会回复确认报文，其中包含 确认序号，作用 就是 告诉发送方 自己接收到了哪些数据，下一次数据 从哪里开始发，  
因此，确认序号 应当是 上次 已成功 收到 数据 字节序号 加 1。  
只有 ACK 标志为 1 时    确认序号字段 才有效。  

3. 控制位：在三次握手 和 四次挥手中 会经常看到 SYN、ACK 和 FIN 的身影，一共有 6 个标志位，它们表示的意义如下：  

URG (Urgent Bit)：值为 1 时，紧急指针生效  

ACK (Acknowledgment Bit)：值为 1 时，确认序号生效   

PSH (Push Bit)：接收方 应尽快 将这个报文段 交给应用层  
RST (Reset Bit)：发送端 遇到问题，想要 重建连接  

SYN (Synchronize Bit)：同步序号，用于发起一个连接    
FIN (Finish Bit)：发送端 要求 关闭连接  




## TCP 的三个重要特性  

1. 面向连接
2. 基于字节流
3. 可靠性







## 它主要通过 以下方式 确保 可靠性，

1. 合理的数据大小：TCP 发送的数据 并不是固定的大小，而是会 根据实际情况 调整报文段的大小。  
2. 检验和：发送端 按照 特定算法 计算出 TCP 报文段的检验 和 并存储在 TCP 首部中的对应字段上，接收端在接收时 会以同样的方式 计算校验和，如果不一致，说明报文段 出现错误，会将其丢弃。  
3. 序号与确认序号：对乱序的数据 进行排序后 发给应用层，并丢弃重复的数据。  
4. 超时重传机制：当 TCP 发出一个报文段后，它会启动一个定时器，等待 目的端 确认收到这个报文段。如果不能及时收到一个确认，将重发这个报文段，后面会细讲这个机制。  
5. 连接管理：也就是三次握手 和四次挥手，连接的可靠性 是整体可靠性的前提。  
6. 流量控制：TCP 双方都有 固定大小的缓冲区，流量控制的原理 是利用  滑动窗口  控制数据发送速度，避免缓冲区溢出导致数据丢失。  
7. 拥塞控制：TCP 利用 慢启动 和 拥塞避免  等算法 实现了 拥塞控制。  
