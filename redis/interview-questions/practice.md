


## 使用过 Redis 做异步队列么，你是怎么用的？有什么缺点？

一般使用 list 结构 作为队列，
rpush 生产消息，lpop 消费消息。
当 lpop 没有消息的时候，要适当 sleep 一会 再重试。

缺点：  
在消费者  下线的情况下，生产的消息  会丢失，得使用专业的消息队列  如 rabbitmq 等。



## 能不能生产一次  消费多次呢？  

使用 pub/sub 主题 订阅者模式，可以实现 1:N 的消息队列。  
















## 缓存穿透

一般的 缓存系统，都是按照 key 去缓存 查询，如果不存在对应的 value，就应该去 后端系统 查找（比如DB）。
一些恶意的请求 会故意查询 不存在的 key,   请求量 很大，就会对后端系统 造成很大的 压力。这就叫做 缓存穿透。

如何避免？
1. 对查询结果为空的情况 也进行缓存，缓存时间 设置短一点，或者该 key 对应的数据 insert 了之后清理缓存。  
2. 对一定不存在的 key 进行过滤。可以 把 所有的 可能存在的 key 放到一个大的 Bitmap 中，查询时 通过该 bitmap 过滤。  






## 缓存雪崩

当缓存服务器 重启 或者  
大量缓存集中 在 某一个时间段 失效，
这样 在失效的时候，
会给后端系统 带来很大压力（请求打到数据库中），导致系统崩溃。

如何避免？  
1. 在缓存失效后，通过  加锁 或者  队列 来控制 读数据库 写缓存的  线程数量。    比如对某个 key 只允许一个线程 查询数据 和 写缓存，   其他线程等待。
2. 做二级缓存，A1 为原始缓存，A2 为拷贝缓存，  A1 失效时，可以访问 A2，       A1 缓存失效时间 设置为短期，  A2 设置为长期
3. 不同的 key，设置不同的 过期时间，让缓存失效的时间点 尽量均匀。
4. 定时刷新。在后台启动一个轮训器，在每个 key  快到过期时间时进行更新
