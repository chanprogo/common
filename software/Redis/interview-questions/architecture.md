
Redis 有哪些架构模式？



### 单机版 

特点：简单   
问题：  
1. 内存容量有限  
2. 处理能力有限  
3. 无法高可用。 




### 主从复制 

Redis 的复制（replication）功能允许用户  
根据一个 Redis 服务器   来创建任意多个   该服务器的复制品，其中被复制的服务器 为主服务器（master），而通过复制创建出来 的服务器复制品 则为从服务器（slave）。  
只要主从服务器之间的 网络连接正常，主从服务器 两者 会具有相同的数据，主服务器 就会一直将发生在自己身上的数据  更新同步 给从服务器，从而一直保证 主从服务器的数据相同。  
特点：
1. master/slave 角色
2. master/slave 数据相同
3. 降低 master 读 压力 在转交从库

问题：  
1. 无法保证高可用
2. 没有解决 master 写的压力




### 哨兵  

Redis sentinel 是一个 分布式系统中 监控 redis 主从服务器，并在 主服务器下线时 自动进行 故障转移。  
其中三个特性：
1. 监控（Monitoring）：    Sentinel  会不断地 检查 你的主服务器 和 从服务器 是否运作正常。
2. 提醒（Notification）： 当被监控的 某个 Redis 服务器 出现问题时， Sentinel 可以通过 API 向管理员 或者 其他应用程序 发送通知。
3. 自动故障迁移（Automatic failover）： 当一个主服务器 不能正常工作时， Sentinel 会开始一次 自动故障迁移操作。

特点：
1. 保证高可用
2. 监控各个节点
3. 自动故障迁移

缺点：
主从模式，切换 需要时间 丢数据，  没有解决 master 写的压力







### 集群（proxy 型） 

Twemproxy 是一个 Twitter 开源的一个 redis 和 memcache 快速/轻量级   代理服务器； 
Twemproxy 是一个快速的  单线程  代理程序，支持 Memcached ASCII 协议   和 redis 协议。

特点：  
1、多种 hash 算法：   MD5、CRC16、CRC32、CRC32a、   hsieh、murmur、Jenkins 
2、支持  失败节点   自动删除
3、后端 Sharding 分片 逻辑   对业务透明，业务方  的读写方式   和操作单个 Redis 一致

缺点：
1. 增加了新的 proxy，需要维护其   高可用。
2. failover 逻辑需要自己实现，其本身  不能支持故障的自动转移，   可扩展性差，进行扩缩容  都需要手动干预








### 集群（直连型）  

从 redis 3.0 之后 版本支持 redis-cluster 集群，Redis-Cluster 采用 无中心结构，
每个节点 保存数据 和 整个集群状态,  每个节点 都和  其他所有节点  连接。   

特点：  
1. 无中心架构（不存在哪个节点 影响性能瓶颈），少了 proxy 层。
2. 数据按照 slot 存储  分布在多个节点，   节点间   数据共享，可动态调整  数据分布。
3. 可扩展性，可线性  扩展到 1000 个节点，  节点可动态添加   或删除。
4. 高可用性，部分节点不可用时，集群仍可用。通过增加 Slave 做 备份数据副
5. 实现  故障自动 failover，  节点之间 通过 gossip 协议   交换状态信息，   用投票机制  完成 Slave 到 Master 的   角色提升。

缺点：  
1. 资源隔离性 较差，容易 出现相互影响 的 情况。  
2. 数据  通过异步复制,不保证  数据的强一致性   











redis 服务部署 有三种模式：  
1. 集群模式。每个节点的 ip+port  
2. 哨兵模式。需要知道 主哨兵 节点 的名称, ip+port  
3. 主从模式。每个节点的 ip+port  